## Agents 开发规范

本项目使用 AI Agents 进行半自动化开发和协作。本文档用于约束和指导后续基于 Agents 的规范化开发，确保代码质量、一致性和可维护性。

---

## 1. 总体原则

- **SOLID 原则**
  - **S（单一职责）**: 每个模块/类/函数只负责一件清晰的事情。
  - **O（开闭原则）**: 对扩展开放，对修改关闭。优先通过新增模块或配置来扩展能力。
  - **L（里氏替换原则）**: 子类型必须可以替换父类型，不破坏现有逻辑。
  - **I（接口隔离）**: 拆分胖接口，避免冗余依赖。
  - **D（依赖倒置）**: 业务逻辑依赖抽象，而不是具体实现，便于替换和测试。

- **DRY 原则（Don’t Repeat Yourself）**
  - 抽取公共逻辑到工具函数、hooks、服务层，而不是在多个组件中复制粘贴。
  - 对于可复用的 UI 片段，优先封装为可组合的组件。

- **SRP 原则（Single Responsibility Principle）**
  - UI 组件只负责展示和基本交互，不直接承载复杂业务逻辑。
  - 服务层/业务模块只负责业务逻辑，不关心 UI 具体如何展示。

- **高内聚，低耦合**
  - 相关的功能代码放在同一模块或同一领域目录下。
  - 模块间通过清晰的接口通信，避免相互强引用和隐式耦合。

- **UI 与核心逻辑分离**
  - **核心逻辑**：放在 service、utils、hooks 等可测试的纯逻辑层。
  - **UI 层**：只通过 props、回调、上下文等方式使用核心逻辑提供的能力。

---

## 2. 代码结构与分层约定

- **自解释的目录与结构**
  - 通过目录结构和文件命名即可大致看出其职责和业务含义，例如按领域/业务模块划分目录（如 `admin/`、`user/`、`profile/` 等）。
  - 避免将不相关的功能堆在同一目录或同一文件中；大文件应按职责拆分为多个更小的模块。
  - 新增代码时，优先考虑“别人只看结构和命名就能猜到用途”，减少额外口头说明的必要。

- **页面层（例如 Next.js 的 `app/*/page.tsx`）**
  - 负责路由、数据获取/预取的入口（如 `getServerSideProps` / `route handlers` / RSC 数据获取）。
  - 将数据与行为通过 props 传递给下层 UI 组件。

- **UI 组件层**
  - 组件保持可复用、可组合、无业务上下文强依赖。
  - 避免在 UI 组件内部直接写复杂业务逻辑或访问全局单例。

- **业务逻辑层（services / domain / use-cases）**
  - 封装具体业务操作（如“创建用户”、“更新个人资料”、“执行某个管理操作”）。
  - 提供清晰的函数接口给页面/组件调用。

- **工具层（utils / helpers）**
  - 封装与具体业务无关的通用函数（格式化、校验、转换等）。

---

## 3. Agents 使用与协作规范

- **1）任务理解与规划**
  - 在修改代码前，Agent 应先：
    - 明确需求目标与范围。
    - 判断是否需要拆分为多个子任务。
    - 评估是否需要编写/更新文档、测试用例。

- **2）代码编辑策略**
  - 优先在现有结构和约定内扩展，不随意引入新的架构风格。
  - 避免一次提交中同时引入大量不相关的重构；若需重构，应与功能开发拆分。
  - 严格遵守项目现有的代码风格、命名约定与目录结构。

- **3）测试与验证**
  - 对有明显逻辑分支的变更，应至少覆盖：
    - 正常路径（happy path）。
    - 主要异常/边界情况（如参数为空、权限不足、数据不存在等）。
  - UI 变更需：
    - 在对应页面进行手动验证或给出可验证步骤。
    - 注意响应式布局和常见浏览器兼容性（如有前端 UI）。

- **4）文档与可读性**
  - 对重要的业务流程或非直观实现，必须撰写注释或更新相关文档。
  - 所有新的公共 API、hooks、服务函数，应在相应模块或 README 中简单说明用途和入参/出参。

---

## 4. 变更规范（适用于 Agents 与人工协作）

- **小步提交**
  - 将大改动拆解为小的、可审查的变更单元。
  - 每个变更尽量只关注一个问题（例如：修复 bug / 增加接口 / 调整 UI）。

- **向下兼容**
  - 修改公共接口（函数签名、API 返回结构）时，优先保证对现有调用方的兼容。
  - 如必须破坏兼容，应在文档中明确说明影响范围与迁移方式。

- **错误处理与日志**
  - 在服务层或接口层对异常进行统一处理，避免将底层错误直接暴露给 UI。
  - 对关键路径（例如权限校验、重要数据变更）适当添加日志或埋点（如果项目中已有相关机制）。

---

## 5. 与外部库、API 的交互

- **抽象外部依赖**
  - 使用适配层/封装函数来隔离第三方库和外部 API，避免在业务逻辑中直接使用第三方细节。
  - 便于将来替换库或调整实现（符合依赖倒置与开闭原则）。

- **配置与密钥**
  - 环境相关配置（API 地址、密钥等）统一使用配置文件或环境变量管理，不应写死在代码中。
  - Agents 在改动涉及配置时，应在文档中说明新增/修改的配置项。

---

## 6. 性能与安全

- **性能**
  - 避免不必要的重复计算和重复请求，适当使用缓存或 memoization（视项目技术栈而定）。
  - UI 层注意减少不必要的重渲染，拆分组件、使用合适的状态管理方案。

- **安全**
  - 对输入数据进行校验和清洗，避免 SQL 注入、XSS 等常见问题。
  - 严格区分客户端/服务端可用数据，敏感数据只在服务端处理，不在前端持久化。

---

## 7. 文档维护与约定更新

- **持续更新**
  - 当引入新的架构模式、规范或工具链时，应同步更新本 `agents.md` 或相关文档。
  - 若发现现有约定无法很好支持新需求，应先在文档层面达成新的共识，再由 Agents/人工共同遵循。

- **变更记录**
  - 对于重要规范调整，可在仓库其他位置（如 `CHANGELOG`、`CONTRIBUTING` 或单独章节）记录变更原因与影响范围。

---

## 8. 最佳实践总结

- **优先考虑可维护性而非一次性最短实现路径。**
- **保持模块职责清晰、接口简洁明确。**
- **减少重复代码，善用抽象与封装。**
- **让 UI 更专注于“展示和交互”，让核心逻辑更专注于“业务与规则”。**

Agents 与人工开发者在本项目中应共同遵循以上规范，以保证整个代码库在长期演进过程中的一致性与可维护性。


